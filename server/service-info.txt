{
    "Rproxy": {
      "name": "rproxy",
      "image": "<ACCOUNT_ID>.dkr.ecr.<REGION>.amazonaws.com/rproxy",
      "memoryLimitMiB": 512,
      "cpu": 256,
      "containerPort":80,
      "policy": {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": [ "ssmmessages:CreateControlChannel", "ssmmessages:CreateDataChannel","ssmmessages:OpenControlChannel","ssmmessages:OpenDataChannel"
            ],
            "Resource": "*"
          }
        ]
      },
      "portMappings": [{
          "name": "rproxy", 
          "containerPort": 80,
          "appProtocol": "ecs.AppProtocol.http",
          "protocol": "ecs.Protocol.TCP"
        }],
      "environment" : {
        "NAMESPACE": "<NAMESPACE>"
      }
    },
    "_comment_removed_services": "REMOVED: Orders and Products microservices - Not needed for EdForge Education Management System. These were part of the original ECS SaaS reference architecture but are not applicable to education domain. EdForge only uses Users and School microservices.",
    "Containers": [
      {
        "name": "users",
        "image": "<ACCOUNT_ID>.dkr.ecr.<REGION>.amazonaws.com/user",
        "memoryLimitMiB": 512,
        "cpu": 256,
        "containerPort": 3010,
        "policy": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Action": [
                "cognito-idp:AdminDeleteUser", "cognito-idp:AdminEnableUser","cognito-idp:AdminCreateUser", "cognito-idp:CreateGroup", "cognito-idp:AdminDisableUser", "cognito-idp:AdminAddUserToGroup","cognito-idp:GetGroup", "cognito-idp:AdminUpdateUserAttributes","cognito-idp:AdminGetUser", "cognito-idp:ListUsers","cognito-idp:ListUsersInGroup", "cognito-idp:AdminListGroupsForUser"
              ],
              "Resource": 
                "arn:aws:cognito-idp:<REGION>:<ACCOUNT_ID>:userpool/<USER_POOL_ID>"
              ,
              "Effect": "Allow"
            }
          ]
        },
        "portMappings": [{
          "name": "users", 
          "containerPort": 3010,
          "appProtocol": "ecs.AppProtocol.http",
          "protocol": "ecs.Protocol.TCP"
        }]

      },
      {
        "name": "school",
        "image": "<ACCOUNT_ID>.dkr.ecr.<REGION>.amazonaws.com/school",
        "memoryLimitMiB": 512,
        "cpu": 256,
        "containerPort": 3010,
        "database": {
            "kind": "dynamodb",
            "sortKey": "entityKey"
        },
        "policy": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Effect": "Allow",
              "Action": [ "ssmmessages:CreateControlChannel", "ssmmessages:CreateDataChannel","ssmmessages:OpenControlChannel","ssmmessages:OpenDataChannel"
              ],
              "Resource": "*"
            }
          ]
        },
        "portMappings": [{
          "name": "school",
          "containerPort": 3010,
          "appProtocol": "ecs.AppProtocol.http",
          "protocol": "ecs.Protocol.TCP"
        }],
        "environment" : {
          "TABLE_NAME": "SCHOOL_TABLE_V2"
        }
      },
      {
        "name": "academic",
        "image": "<ACCOUNT_ID>.dkr.ecr.<REGION>.amazonaws.com/academic",
        "memoryLimitMiB": 512,
        "cpu": 256,
        "containerPort": 3010,
        "_comment_shared_database": "Academic service shares DynamoDB table with School service. Since it doesn't create its own table, TABLE_NAME must be set to the ACTUAL table name that will be created (school-table-v2-basic for basic tier)",
        "policy": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Effect": "Allow",
              "Action": [ 
                "ssmmessages:CreateControlChannel", 
                "ssmmessages:CreateDataChannel",
                "ssmmessages:OpenControlChannel",
                "ssmmessages:OpenDataChannel"
              ],
              "Resource": "*"
            },
            {
              "Effect": "Allow",
              "Action": [
                "dynamodb:PutItem",
                "dynamodb:GetItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:Query",
                "dynamodb:Scan",
                "dynamodb:BatchGetItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:ConditionCheckItem"
              ],
              "Resource": [
                "arn:aws:dynamodb:<REGION>:<ACCOUNT_ID>:table/school-table-v2-basic",
                "arn:aws:dynamodb:<REGION>:<ACCOUNT_ID>:table/school-table-v2-basic/index/*"
              ]
            }
          ]
        },
        "portMappings": [{
          "name": "academic",
          "containerPort": 3010,
          "appProtocol": "ecs.AppProtocol.http",
          "protocol": "ecs.Protocol.TCP"
        }],
        "environment" : {
          "TABLE_NAME": "school-table-v2-basic"
        }
      }
    ]
}
  